/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/dnd/DragInfo","sap/ui/core/dnd/DropInfo","sap/ui/events/KeyCodes","sap/ui/core/dnd/DropPosition"],function(e,t,r,i){"use strict";var n="Before",a="insertBefore",s="insertAfter",o,g="IconTabReorder",f="Forward",l="Backward";var u={_insertControl:function(e,t,r,i){var n=t.$(),a=r.$(),o=[],g=[];if(t._getNestedLevel()>1&&r._getNestedLevel()>1){o=t._getRootTab()._getSelectList().getItems().filter(function(e){return t._getRealTab()._isParentOf(e._getRealTab())});g=r._getRootTab()._getSelectList().getItems().filter(function(e){return r._getRealTab()._isParentOf(e._getRealTab())})}if(i){var f=t._getRootTab().getParent()._getOverflow()._getSelectList().getItems();o=f.filter(function(e){return t._getRealTab()._isParentOf(e._getRealTab())});g=f.filter(function(e){return r._getRealTab()._isParentOf(e._getRealTab())})}if(e===s){n.insertAfter(a)}else{n.insertBefore(a)}o.reverse().forEach(function(e){e.$().insertAfter(n)});g.reverse().forEach(function(e){e.$().insertAfter(a)})},handleDrop:function(e,t,r,g,f,l){var c=e.indexOfItem(r),d=e.indexOfItem(g),_=0,b=sap.ui.getCore().getConfiguration().getRTL(),p=t===n,h=g._getNestedLevel()-1;if(r._isParentOf(g)){return}if(h===l&&t===i.On){return}if(b&&!f){if(p){_=c<d?d:d+1;o=s}else{_=c<d?d-1:d;o=a}}else{if(p){_=c<d?d-1:d;o=a}else{_=c<d?d:d+1;o=s}}if(e.isA("sap.m.IconTabFilter")||!r.getParent().isA("sap.m.IconTabHeader")){if(p){_=d}else{_=d+1}}u._insertControl(o,r,g);if(t===i.On){if(g===r){return}_=e.getAggregation("items").length}u._handleConfigurationAfterDragAndDrop.call(e,r,_)},_updateAccessibilityInfo:function(){var e=this.getItems(),t=1,r;e.forEach(function(e){r=e.getDomRef();if(r&&r.getAttribute("aria-posinset")!==null){r.setAttribute("aria-posinset",t++)}})},_handleConfigurationAfterDragAndDrop:function(e,t){var r=[];if(this.isA("sap.m.IconTabBarSelectList")){r=this.getItems().filter(function(t){return e._getRealTab()._isParentOf(t._getRealTab())})}this.removeAggregation("items",e,true);this.insertAggregation("items",e,t,true);r.forEach(function(e){this.removeAggregation("items",e,true)}.bind(this));var i=1+this.indexOfAggregation("items",e);r.reverse().forEach(function(e){this.insertAggregation("items",e,i,true)}.bind(this));u._updateAccessibilityInfo.call(this)},_decreaseDropIndex:function(e,t){var r=e-1;while(r>=0&&(t[e]._getRealTab()._getNestedLevel()!==t[r]._getRealTab()._getNestedLevel()||!t[r].getVisible()||!t[e].$().hasClass("sapMITBFilterHidden")&&t[r].$().hasClass("sapMITBFilterHidden"))){r--}if(r<0){o=s;return e}o=a;return r},_increaseDropIndex:function(e,t,r){var i=e+1;while(i<t.length&&(t[e]._getRealTab()._getNestedLevel()!==t[i]._getRealTab()._getNestedLevel()||!t[i].getVisible())){i++}if(i>r){o=a;return e}o=s;return i},moveItem:function(e,t,i){var n=this.getItems(),g=this.indexOfItem(e),c=sap.ui.getCore().getConfiguration().getRTL(),d,_;if(this.isA("sap.m.IconTabFilter")){n=this._getRealTab().getItems()}switch(t){case r.HOME:d=0;o=a;break;case r.END:d=n.length-1;o=s;break;case r.ARROW_LEFT:if(c){_=u.preventDragBetweenSubItems(e,f,this);d=u._increaseDropIndex(g,n,i)}else{_=u.preventDragBetweenSubItems(e,l,this);d=u._decreaseDropIndex(g,n)}break;case r.ARROW_RIGHT:if(c){_=u.preventDragBetweenSubItems(e,l,this);d=u._decreaseDropIndex(g,n)}else{_=u.preventDragBetweenSubItems(e,f,this);d=u._increaseDropIndex(g,n,i)}break;case r.ARROW_DOWN:_=u.preventDragBetweenSubItems(e,f,this);d=u._increaseDropIndex(g,n,i);break;case r.ARROW_UP:_=u.preventDragBetweenSubItems(e,l,this);d=u._decreaseDropIndex(g,n);break;default:return false}if(_){return false}if(!this.isA("sap.m.IconTabFilter")){var b=n[d];u._insertControl(o,e,b,this._oTabFilter&&this._oTabFilter._bIsOverflow)}u._handleConfigurationAfterDragAndDrop.call(this,e,d);return true},setDragDropAggregations:function(r,i,n){var a=r._oIconTabHeader?r._oIconTabHeader:r;var s=a.getId();r.addDragDropConfig(new e({sourceAggregation:"items",groupName:g+s}));r.addDragDropConfig(new t({targetAggregation:"items",dropPosition:n,dropLayout:i,drop:r._handleDragAndDrop.bind(r),groupName:g+s}))},preventDragBetweenSubItems:function(e,t,r){var i=false;if(r.isA("sap.m.IconTabBarSelectList")){var n=e._getRealTab(),a=n.getParent(),s=a.getItems();if(s.indexOf(n)===0&&t===l||s.indexOf(n)+1===s.length&&t===f||s.length===1){i=true}}return i}};return u});