/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/unified/calendar/CalendarUtils","sap/ui/unified/calendar/CalendarDate","sap/ui/unified/CalendarLegend","sap/ui/unified/CalendarLegendRenderer","sap/ui/core/library","sap/ui/unified/library","sap/base/Log","sap/ui/core/InvisibleText"],function(e,a,t,i,n,r,s,d){"use strict";var l=r.CalendarDayType;var o=n.CalendarType;var c={apiVersion:2};c.render=function(e,a){var t=this.getStartDate(a),i=a.getTooltip_AsString(),n=sap.ui.getCore().getLibraryResourceBundle("sap.ui.unified"),r=a.getId(),s={value:"",append:true},l="",o=a.getWidth();e.openStart("div",a);this.getClass(e,a).forEach(function(a){e.class(a)});if(a._getSecondaryCalendarType()){e.class("sapUiCalMonthSecType")}this.addWrapperAdditionalStyles(e,a);if(i){e.attr("title",i)}if(a._getShowHeader()){s.value=s.value+" "+r+"-Head"}if(a._bCalendar){l+=" "+d.getStaticId("sap.ui.unified","CALENDAR_MONTH_PICKER_OPEN_HINT")+" "+d.getStaticId("sap.ui.unified","CALENDAR_YEAR_PICKER_OPEN_HINT")}if(o){e.style("width",o)}e.accessibilityState(a,{role:"grid",roledescription:n.getText("CALENDAR_DIALOG"),multiselectable:!a.getSingleSelection()||a.getIntervalSelection(),labelledby:s,describedby:l});e.openEnd();if(a.getIntervalSelection()){e.openStart("span",r+"-Start");e.style("display","none");e.openEnd();e.text(n.getText("CALENDAR_START_DATE"));e.close("span");e.openStart("span",r+"-End");e.style("display","none");e.openEnd();e.text(n.getText("CALENDAR_END_DATE"));e.close("span")}this.renderMonth(e,a,t);e.close("div")};c.addWrapperAdditionalStyles=function(){};c.getStartDate=function(e){return e._getDate()};c.getClass=function(e,a){var t=["sapUiCalMonthView"],i=a.getPrimaryCalendarType(),n=a.getShowWeekNumbers();if(i===o.Islamic||!n){t.push("sapUiCalNoWeekNum")}return t};c.renderMonth=function(e,a,t){this.renderHeader(e,a,t);this.renderDays(e,a,t)};c.renderHeader=function(e,a,t){var i=a._getLocaleData();var n=a._getFirstDayOfWeek();this.renderHeaderLine(e,a,i,t);e.openStart("div");e.accessibilityState(null,{role:"row"});e.style("overflow","hidden");e.openEnd();this.renderDayNames(e,a,i,n,7,true,undefined);e.close("div")};c.renderHeaderLine=function(a,t,i,n){e._checkCalendarDate(n);if(t._getShowHeader()){var r=t.getId();var s=t.getPrimaryCalendarType();var d=i.getMonthsStandAlone("wide",s);a.openStart("div",r+"-Head");a.class("sapUiCalHeadText");a.openEnd();a.text(d[n.getMonth()]);a.close("div")}};c.renderDayNames=function(e,a,t,i,n,r,s){var d=a._getFirstDayOfWeek();var l=a.getId();var o="";var c=a.getPrimaryCalendarType();var p=[];if(a._bLongWeekDays||!a._bNamesLengthChecked){p=t.getDaysStandAlone("abbreviated",c)}else{p=t.getDaysStandAlone("narrow",c)}var g=t.getDaysStandAlone("wide",c);if(a.getShowWeekNumbers()){this.renderDummyCell(e,"sapUiCalWH",true,"columnheader")}for(var y=0;y<n;y++){if(r){o=l+"-WH"+(y+d)%7}else{o=l+"-WH"+y}e.openStart("div",o);e.class("sapUiCalWH");if(y===0){e.class("sapUiCalFirstWDay")}if(s){e.style("width",s)}e.accessibilityState(null,{role:"columnheader",label:g[(y+i)%7]});e.openEnd();e.text(p[(y+i)%7]);e.close("div")}};c.renderDays=function(a,t,i){var n,r,s,d,l,c,p;e._checkCalendarDate(i);if(!i){i=t._getFocusedDate()}c=i.toUTCJSDate().getTime();if(!c&&c!==0){throw new Error("Date is invalid "+t)}d=this.getDayHelper(t,i);r=t._getVisibleDays(i,true);p=t.getShowWeekNumbers();n=t.getPrimaryCalendarType()!==o.Islamic&&p;s=r.length;for(l=0;l<s;l++){if(l%7===0){a.openStart("div");a.attr("role","row");a.openEnd();if(n){this._renderWeekNumber(a,r[l],d)}}this.renderDay(a,t,r[l],d,true,n,-1);if(l%7===6){a.close("div")}}if(s===28){this.renderDummyCell(a,"sapUiCalItem",false,"")}};c.renderDummyCell=function(e,a,t,i){e.openStart("div");e.class(a);e.class("sapUiCalDummy");e.style("visibility",t?"visible":"hidden");e.attr("role",i);e.attr("tabindex","-1");e.openEnd();e.close("div")};c.getDayHelper=function(e,i){var n,r,d=e._getLocaleData(),l={sLocale:e._getLocale(),oLocaleData:d,iMonth:i.getMonth(),iYear:i.getYear(),iFirstDayOfWeek:e._getFirstDayOfWeek(),iWeekendStart:d.getWeekendStart(),iWeekendEnd:d.getWeekendEnd(),aNonWorkingDays:e._getNonWorkingDays(),sToday:d.getRelativeDay(0),oToday:a.fromLocalJSDate(new Date,e.getPrimaryCalendarType()),sId:e.getId(),oFormatLong:e._getFormatLong(),sSecondaryCalendarType:e._getSecondaryCalendarType(),oLegend:undefined};r=e.getLegend();if(r&&typeof r==="string"){n=sap.ui.getCore().byId(r);if(n){if(!(n instanceof t)){throw new Error(n+" is not an sap.ui.unified.CalendarLegend. "+e)}l.oLegend=n}else{s.warning("CalendarLegend "+r+" does not exist!",e)}}return l};c.renderDay=function(t,n,r,s,d,o,c,p,g){e._checkCalendarDate(r);var y=new a(r,s.sSecondaryCalendarType),f={role:n._getAriaRole(),selected:false,label:"",describedby:""},u=r._bBeforeFirstYear,D="",C=s.oLegend,S;var b=n._oFormatYyyymmdd.format(r.toUTCJSDate(),true);var h=r.getDay();var m=n._checkDateSelected(r);var W=n._getDateTypes(r);var v=n._checkDateEnabled(r);var k=0;if(u){v=false}t.openStart("div",s.sId+"-"+b);t.class("sapUiCalItem");t.class("sapUiCalWDay"+h);if(p){t.style("width",p)}if(h===s.iFirstDayOfWeek){t.class("sapUiCalFirstWDay")}if(d&&s.iMonth!==r.getMonth()){t.class("sapUiCalItemOtherMonth");f["disabled"]=true}if(r.isSame(s.oToday)){t.class("sapUiCalItemNow");f["label"]=s.sToday+" "}if(m>0){t.class("sapUiCalItemSel");f["selected"]=true}else{f["selected"]=false}if(m===2){t.class("sapUiCalItemSelStart");f["describedby"]=f["describedby"]+" "+s.sId+"-Start"}else if(m===3){t.class("sapUiCalItemSelEnd");f["describedby"]=f["describedby"]+" "+s.sId+"-End"}else if(m===4){t.class("sapUiCalItemSelBetween")}else if(m===5){t.class("sapUiCalItemSelStart");t.class("sapUiCalItemSelEnd");f["describedby"]=f["describedby"]+" "+s.sId+"-Start";f["describedby"]=f["describedby"]+" "+s.sId+"-End"}W.forEach(function(e){if(e.type!==l.None){if(e.type===l.NonWorking){t.class("sapUiCalItemWeekEnd");if(this._checkIfNonWorkingLegendItemExist(C)){S=this._addNonWorkingDayText(f)}return}t.class("sapUiCalItem"+e.type);D=e.type;if(e.tooltip){t.attr("title",e.tooltip)}}}.bind(this));if(!S){if(this._checkIfNonWorkingLegendItemExist(C)){if(s.aNonWorkingDays){s.aNonWorkingDays.forEach(function(e){if(r.getDay()===e){this._addNonWorkingDayText(f)}}.bind(this))}else if(r.getDay()===s.iWeekendStart||r.getDay()===s.iWeekendEnd){this._addNonWorkingDayText(f)}}}if((n.getParent()&&n.getParent().getMetadata().getName()==="sap.ui.unified.CalendarOneMonthInterval"||n.getMetadata().getName()==="sap.ui.unified.calendar.OneMonthDatesRow")&&n.getStartDate()&&r.getMonth()!==n.getStartDate().getMonth()){t.class("sapUiCalItemOtherMonth")}if(!v){t.class("sapUiCalItemDsbl");f["disabled"]=true}if(s.aNonWorkingDays){for(k=0;k<s.aNonWorkingDays.length;k++){if(h===s.aNonWorkingDays[k]){t.class("sapUiCalItemWeekEnd");break}}}else if(h>=s.iWeekendStart&&h<=s.iWeekendEnd||s.iWeekendEnd<s.iWeekendStart&&(h>=s.iWeekendStart||h<=s.iWeekendEnd)){t.class("sapUiCalItemWeekEnd")}t.attr("tabindex","-1");t.attr("data-sap-day",b);if(g){f["label"]=f["label"]+s.aWeekDaysWide[h]+" "}f["label"]=f["label"]+s.oFormatLong.format(r.toUTCJSDate(),true);if(D!==""){i.addCalendarTypeAccInfo(f,D,C)}if(s.sSecondaryCalendarType){f["label"]=f["label"]+" "+n._oFormatSecondaryLong.format(y.toUTCJSDate(),true)}t.accessibilityState(null,f);t.openEnd();if(W[0]){t.openStart("div");t.class("sapUiCalSpecialDate");if(W[0].color){t.style("background-color",W[0].color)}t.openEnd();t.close("div")}t.openStart("span");t.class("sapUiCalItemText");if(!!W[0]&&W[0].color){t.class("sapUiCalItemTextCustomColor")}t.openEnd();if(!u){t.text(r.getDate())}t.close("span");if(g){t.openStart("span");t.class("sapUiCalDayName");t.openEnd();t.text(s.aWeekDays[h]);t.close("span")}if(s.sSecondaryCalendarType){t.openStart("span");t.class("sapUiCalItemSecText");t.openEnd();t.text(y.getDate());t.close("span")}t.close("div")};c._checkIfNonWorkingLegendItemExist=function(e){var a;if(e){e.getStandardItems().forEach(function(e){if(e===r.StandardCalendarLegendItem.NonWorkingDay){a=true;return}})}return a};c._addNonWorkingDayText=function(e){var a=sap.ui.getCore().getLibraryResourceBundle("sap.ui.unified").getText("LEGEND_NON_WORKING_DAY")+" ";e["label"]+=a;return a};c._renderWeekNumber=function(a,t,i){var n=e.calculateWeekNumber(t.toUTCJSDate(),i.iYear,i.sLocale,i.oLocaleData),r=i.sId+"-WNum-"+n;a.openStart("div",r);a.class("sapUiCalWeekNum");a.accessibilityState(null,{role:"rowheader",labelledby:d.getStaticId("sap.ui.unified","CALENDAR_WEEK")+" "+r});a.openEnd();a.text(n);a.close("div")};return c},true);