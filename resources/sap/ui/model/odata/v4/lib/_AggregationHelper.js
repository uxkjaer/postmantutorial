/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/model/Filter"],function(e){"use strict";var t={grandTotal:"boolean",max:"boolean",min:"boolean",name:"string",subtotals:"boolean",with:"string"},r={aggregate:"object",group:"object",groupLevels:"array"},i;function n(e,t,r){var i;function n(e){if(r){e+=" at property: "+r}throw new Error(e)}function a(e){return Array.isArray(e)?"array":typeof e}for(i in e){if(!(t&&i in t)){n("Unsupported '"+i+"'")}else if(a(e[i])!==t[i]){n("Not a "+t[i]+" value for '"+i+"'")}}}function a(e,t){var r;for(r in e){n(e[r],t,r)}}i={buildApply:function(e,i,o,g){var f,u="",s=[],l,p,c;function d(t){var r=e.aggregate[t],n=r.name||t,a=t,o=r.with;if(o){if((o==="average"||o==="countdistinct")&&(r.grandTotal||r.subtotals)){throw new Error("Cannot aggregate totals with '"+o+"'")}n+=" with "+o+" as "+t}else if(r.name){n+=" as "+t}if(!g){if(r.min){h(t,"min")}if(r.max){h(t,"max")}}if(r.grandTotal){p=true;if(!i.$skip){if(o){a+=" with "+o+" as UI5grand__"+t}s.push(a)}}return n}function $(t){return e.groupLevels.indexOf(t)<0}function h(e,t){var r="UI5"+t+"__"+e;s.push(e+" with "+t+" as "+r);if(o){o[r]={measure:e,method:t}}}function b(){var e="";if(i.$skip){e="skip("+i.$skip+")"}delete i.$skip;if(i.$top<Infinity){if(e){e+="/"}e+="top("+i.$top+")"}delete i.$top;return e}i=Object.assign({},i);n(e,r);e.groupLevels=e.groupLevels||[];e.aggregate=e.aggregate||{};a(e.aggregate,t);f=Object.keys(e.aggregate).sort().map(d);if(p&&e.groupLevels.length){throw new Error("Cannot combine visual grouping with grand total")}if(f.length){u="aggregate("+f.join(",")+")"}e.group=e.group||{};a(e.group);l=e.groupLevels.concat(Object.keys(e.group).sort().filter($));if(l.length){u="groupby(("+l.join(",")+(u?"),"+u+")":"))")}if(g){delete i.$count}else if(i.$count){s.push("$count as UI5__count");delete i.$count}if(i.$$filterBeforeAggregate){u="filter("+i.$$filterBeforeAggregate+")/"+u;delete i.$$filterBeforeAggregate}if(i.$filter){u+="/filter("+i.$filter+")";delete i.$filter}if(i.$orderby){u+="/orderby("+i.$orderby+")";delete i.$orderby}if(p){if(i.$skip){i.$skip-=1}else{i.$top-=1}}c=b();if(s.length){u+="/concat(aggregate("+s.join(",")+"),"+(c||"identity")+")"}else if(c){u+="/"+c}if(u){i.$apply=u}return i},hasGrandTotal:function(e){return!!e&&Object.keys(e).some(function(t){return e[t].grandTotal})},hasMinOrMax:function(e){return!!e&&Object.keys(e).some(function(t){var r=e[t];return r.min||r.max})},splitFilter:function(t,r){var i=[],n=[];function a(e){return e.aFilters?e.aFilters.some(a):e.sPath in r.aggregate}function o(e){if(e.aFilters&&e.bAnd){e.aFilters.forEach(o)}else{(a(e)?i:n).push(e)}}function g(t){return t.length>1?new e(t,true):t[0]}if(!r||!r.aggregate){return[t]}o(t);return[g(i),g(n)]}};return i},false);